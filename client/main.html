<head>
    <title>hustle</title>
    <!-- <link href="https://unpkg.com/@ionic/core@4.0.0-beta.17/css/ionic.bundle.css" rel="stylesheet">
    <script src="https://unpkg.com/@ionic/core@4.0.0-beta.17/dist/ionic.js"></script> -->
    <script src="//cdn.pubnub.com/pubnub-3.14.5.min.js"></script>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
</head>

<body>
    <link
        rel="stylesheet"
        type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/Ladda/1.0.0/ladda.min.css"
    />
    <div id="react-target"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        document.addEventListener("deviceready", () => {
            if (window.cordova && window.cordova.plugins.Keyboard) {
                window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar(false);
            }

            cordova.plugins.notification.local.hasPermission( (granted) => {
                if(!granted) {
                    cordova.plugins.notification.local.registerPermission(function (granted) {});
                }
            });

            var deniedCount = 0;

            function onError(error){
                console.error("The following error occurred: "+error);
            }

            function evaluateAuthorizationStatus(status){
                switch(status){
                case cordova.plugins.diagnostic.permissionStatus.NOT_REQUESTED:
                    console.log("Permission not requested");
                    requestAuthorization();
                    break;
                case cordova.plugins.diagnostic.permissionStatus.DENIED:
                    console.log("Permission denied");
                    if(deniedCount < 3){
                        deniedCount++;
                        requestAuthorization();
                    }else{
                        // Are we sure we want to hassle the user more than 3 times?
                    }
                    break;
                case cordova.plugins.diagnostic.permissionStatus.DENIED_ALWAYS:
                    console.log("Permission permanently denied");
                    navigator.notification.confirm(
                            "This app has been denied access to your location and it really needs it function properly. Would you like to switch to the app settings page to allow access?", 
                            function (i) {
                                if (i === 1) {
                                    cordova.plugins.diagnostic.switchToSettings();
                                }
                            }, "Location access denied", ['Yes', 'No']);
                    break;
                case cordova.plugins.diagnostic.permissionStatus.GRANTED:
                    console.log("Permission granted always");
                    // Yay! use location
                    break;        
            }
            }

            function requestAuthorization(){
                cordova.plugins.diagnostic.requestLocationAuthorization(evaluateAuthorizationStatus, onError);
            }

            function checkAuthorization(){
                cordova.plugins.diagnostic.getLocationAuthorizationStatus(evaluateAuthorizationStatus, onError);
            }

            checkAuthorization();
        }, false);

        if(!window.cordova) {
            console.log(Notification)
            if(Notification) {
                Notification.requestPermission();
            }
        }

        document.addEventListener('focusout', function(e) {window.scrollTo(0, 0)});

    </script>
</body>